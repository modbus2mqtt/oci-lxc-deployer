services:
  zitadel:
    image: ghcr.io/zitadel/zitadel:${ZITADEL_VERSION:-v4.10.1}
    restart: unless-stopped
    command: 'start-from-init --masterkey "${ZITADEL_MASTERKEY:-MustBeAtLeast32CharactersLongKey!}" --tlsMode disabled'
    environment:
      ZITADEL_EXTERNALDOMAIN: ${ZITADEL_EXTERNALDOMAIN:-localhost}
      ZITADEL_EXTERNALSECURE: ${ZITADEL_EXTERNALSECURE:-false}
      ZITADEL_EXTERNALPORT: ${ZITADEL_PORT:-8080}
      ZITADEL_DATABASE_POSTGRES_HOST: ${DB_HOST:-postgres}
      ZITADEL_DATABASE_POSTGRES_PORT: ${DB_PORT:-5432}
      ZITADEL_DATABASE_POSTGRES_DATABASE: ${DB_NAME:-zitadel}
      ZITADEL_DATABASE_POSTGRES_USER_USERNAME: ${DB_USER:-zitadel}
      ZITADEL_DATABASE_POSTGRES_USER_PASSWORD: ${DB_PASSWORD:-secret123}
      ZITADEL_DATABASE_POSTGRES_USER_SSL_MODE: ${DB_SSL_MODE:-disable}
      ZITADEL_DATABASE_POSTGRES_ADMIN_USERNAME: ${DB_USER:-zitadel}
      ZITADEL_DATABASE_POSTGRES_ADMIN_PASSWORD: ${DB_PASSWORD:-secret123}
      ZITADEL_DATABASE_POSTGRES_ADMIN_SSL_MODE: ${DB_SSL_MODE:-disable}
      ZITADEL_FIRSTINSTANCE_ORG_HUMAN_USERNAME: ${ADMIN_USER:-admin}
      ZITADEL_FIRSTINSTANCE_ORG_HUMAN_PASSWORD: ${ADMIN_PASSWORD:-secret123}
    ports:
      - "${ZITADEL_PORT:-8080}:8080"
    healthcheck:
      test: ["CMD", "/app/zitadel", "ready"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
